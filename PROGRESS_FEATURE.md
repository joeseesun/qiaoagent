# 实时进度显示功能

## 功能说明

现在系统已经添加了实时进度显示功能，用户在点击"开始生成"后可以看到：

### 1. 进度卡片
- 显示当前执行的 Agent 名称
- 显示每个阶段的任务进度
- 实时更新执行状态

### 2. 进度日志
每条日志包含：
- 🚀 任务开始
- 🤖 Agent 执行状态
- 📝 任务详情
- ✅ 阶段性输出
- 🎉 完成状态
- ❌ 错误信息（如有）

### 3. 视觉反馈
- 不同类型的日志使用不同颜色背景
- Agent 执行时显示旋转动画
- 完成时显示勾选图标
- 每条日志显示时间戳

## 技术实现

### 前端 (app/page.tsx)
- 使用 EventSource API 接收 Server-Sent Events (SSE)
- 实时更新进度日志数组
- 使用 Framer Motion 添加动画效果
- 自动滚动到最新日志

### 后端 (app/api/run_crew_stream/route.ts)
- 创建 SSE 流式响应
- 调用 Python 脚本并捕获输出
- 解析 PROGRESS: 标记的进度消息
- 将进度实时推送到前端

### Python (crew/main.py)
- 新增 `send_progress()` 函数
- 新增 `run_workflow_with_progress()` 函数
- 在关键步骤发送进度更新：
  - 加载配置
  - 创建 Agent
  - 创建任务
  - 执行工作流
  - 解析结果

## 使用方法

1. 访问 http://localhost:3001
2. 选择工作流
3. 输入主题
4. 点击"开始生成"
5. 观察实时进度显示

## 进度消息类型

- `task`: 任务级别的进度（蓝色背景）
- `agent`: Agent 执行状态（蓝色背景，带旋转图标）
- `output`: 阶段性输出（灰色背景）
- `complete`: 完成状态（绿色背景）
- `error`: 错误信息（红色背景）

## 示例进度流程

```
🚀 开始执行工作流...
📝 加载工作流配置...
📝 工作流: 营销文案生成器
📝 初始化 AI 模型...
📝 创建 2 个 Agent...
🤖 市场分析师 - 市场研究专家
🤖 文案撰写师 - 创意文案专家
📝 创建 2 个任务...
📝 任务 1: 分析目标市场...
📝 任务 2: 撰写营销文案...
📝 开始执行工作流...
🤖 Agent "市场分析师" 正在执行任务 1/2...
🤖 Agent "文案撰写师" 正在执行任务 2/2...
✅ 正在解析结果...
✅ 生成标题: XXX
✅ 生成内容: 1234 字符
🎉 生成完成！
```

## 注意事项

1. SSE 连接超时设置为 5 分钟（300 秒）
2. 如果连接中断，会显示错误提示
3. 进度日志最多显示 264px 高度，超出部分可滚动
4. 每条日志都有时间戳，方便追踪执行时间

## 后续优化建议

1. 添加进度百分比显示
2. 添加预计剩余时间
3. 支持取消正在执行的任务
4. 保存历史执行记录
5. 添加更详细的 Agent 思考过程展示

